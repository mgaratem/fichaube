<html>
  <body>
    <p>Area: {{ nombreArea }}</p>
    <form id="formularioNuevaEspecialidad" action="agregarEspecialidad" method="post"> {% csrf_token %}
      {{ form.as_p }}
      <label for="especialidad">Ingrese Especialidad: </label>
      <br>
      <input id="especialidad" type="text" name="especialidad">
      <input type="hidden" value={{ idArea }} name="idArea">
      <input type="submit" value="Submit">
    </form>


   <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    {% block javascript %}
      <script>  // AJAX para corroborar que la especialidad ya existe

      //  validar formulario
      $('#formularioNuevaEspecialidad').submit(function(e){
        e.preventDefault();
        var form = this;
        var especialidad = $('#especialidad').val();
        especialidad = especialidad.trim();
        // formulario no esta vacio
        if (especialidad == null || especialidad == ""){
          alert('Debe ingresar una Especialidad');
          return false;
        }
        else{
          // codigo AJAX  para comprobar si la especialidad existe previamente
          $.ajax({
            url: 'ajax/validarEspecialidad',
            data: {
              'especialidad': especialidad
            },
            dataType: 'json',
            success: function (data) {
              if (data.is_taken){
                alert('La Especialidad ingresada ya se encuentra registrada');
                return false;
              }
              else{
                form.submit();
              }
          }
        }); // fin AJAX
      }
    });

      </script>
    {% endblock %}
  </body>
</html>
