{% extends 'home.html' %}
{% load static %}
{% load auth_extras %}

{% block content %}


<div class="col-sm-12 col-sm-offset-1">
    <div class="header text-center">
        <h2>Ficha Alumno</h2>
    </div>
</div>

{% if messages %}
    {% for message in messages %}
    {% if  message.tags == "error" %}
    <div class="alert alert-danger" role="alert">
    {% else %}
    <div class="alert alert-success" role="alert">
    {% endif %}
        {{message}}
    </div>
    {% endfor %}
{% endif %}

<div class="col-sm-12 col-sm-offset-1">
    <div class="card">
        <div class="card-content">
            <div class="cuadrotrans">
                <h3>Datos personales</h3>
                <div class="row">
                  <div class="col-auto mr-auto"></div>
                  <div class="col-auto">
                    <a href="{% url 'alumnos:updateAlumno' id_alumno=alumno.id %}" style="color:#339fc3;" data-content="Editar" rel="popover" data-placement="bottom" data-trigger="hover">
                      <i class="zmdi zmdi-edit" style="font-size:20px; color:#339fc3;"></i>
                    </a>
                  </div>
                </div>
                </br>
                </br>
                <div class="row">
                    <div class="col-sm-12">
                        <div class="row">
                            <div class="col-sm-6">
                                <h6>Nombre</h6>
                                <p style="text-transform: uppercase;">{{ alumno.apellido_paterno }} {{ alumno.apellido_materno }} {{ alumno.nombre }}</p>
                            </div>
                            <div class="col-sm-3">
                                <h6>RUT/PASAPORTE</h6>
                                <p>{{ alumno.rut }}</p>
                            </div>
                            <div class="col-sm-3">
                                <h6>Carrera</h6>
                                <p>{{ alumno.carrera }}</p>
                                <!-- BEGIN: Separacion interlineado -->
                                <p>
                                    <br><br>
                                </p>
                                <!-- END: Separacion interlineado -->
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-sm-6">
                                <h6>Correo alumno</h6>
                                <p>
                                    <a href="mailto:{{ alumno.correo }}">{{ alumno.correo }}</a>
                                </p>
                            </div>
                            <div class="col-sm-3">
                                <h6>Fecha Nacimiento</h6>
                                {% if alumno.get_fecha %}
                                <p>{{ alumno.get_fecha }}</p>
                                {% endif %}
                            </div>
                            <div class="col-sm-3">
                                <h6>Sexo</h6>
                                <p>{{ alumno.sexo }}</p>
                                <!-- BEGIN: Separacion interlineado -->
                                <p>
                                    <br><br>
                                </p>
                                <!-- END: Separacion interlineado -->
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-sm-6">
                                <h6>Domicilio</h6>
                                <p>{{ alumno.domicilio }}</p>
                            </div>
                            <div class="col-sm-3">
                                <h6>Prevision</h6>
                                <p>{{ alumno.prevision }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% if request.user|has_group:"Coordinador" or request.user|has_group:"Profesional" or request.user|has_group:"Asistente Social" or request.user.is_superuser%}
<div class="col-sm-12 col-sm-offset-1">
    <div class="card">
        <div class="card-content">
            <div class="cuadrotrans">
                <h3>Ficha Clínica</h3>
                </br>
                </br>

                {% if not ficha %}

                <p>Este alumno aún no tiene ficha clínica creada.</p>

                <p>¡Ups! Usted no tiene permisos para visualizar la ficha clínica.</p>

                {% else %}
                <div class="row">
                  <form method="POST" style="width:100%">
                    {% csrf_token %}
                    <div class="row">
                      <div class="col-sm-6">
                        <h6>Observaciones:</h6>
                        <textarea name="inputObservaciones" rows="4" cols="70" required></textarea>
                        <br>
                        <h6>Decisión Alumno:</h6>
                        <textarea name="inputDecision" rows="3" cols="70"></textarea>
                      </div>
                      <div class="col-sm-4">
                        <h6>Motivo Atención:</h6>
                        <select class="custom-select mr-sm-2" name="inputMotivo" required>
                          <option value="" selected>Elegir...</option>
                          <option value="1">Profesional</option>
                          <option value="2">Administrativo</option>
                          <option value="3">Mantenedor</option>
                          <option value="4">Asistente Social</option>
                        </select>
                      </div>
                    </div>
                  </form>
                </div>

                <hr>

                <div class="row">
                    <table class="table table-hover table-bordered" style="width:100%">
                        <thead class="table-head">
                            <th>Fecha</th>
                            <th>Motivo de Atención</th>
                            <th>Observaciones</th>
                            <th>Decisión Alumno</th>
                            <th>Profesional</th>
                        </thead>
                        <tbody>
                            {% for registro in registros %}
                            <tr>
                                <td style="width:20%">{{registro.get_fecha}}</td>
                                <td style="width:20%">{{registro.motivo_atencion}}</td>
                                <td style="width:20%">{{registro.descripcion_atencion}}</td>
                                <td style="width:20%">{{registro.decision_alumno}}</td>
                                <td style="width:20%">{{registro.profesional.nombre}} {{registro.profesional.apellidos}}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                  </div>

                {% endif %}

            </div>
        </div>
    </div>
</div>
{% endif %}

{% if request.user|has_group:"Coordinador" or request.user|has_group:"Administrativo" or request.user.is_superuser %}

<div class="col-sm-12 col-sm-offset-1">
    <div class="card">
        <div class="card-content">
            <div class="cuadrotrans">
                <h3>Permisos</h3>
                </br>
                </br>
                {% if %}
                <table class="table table-hover table-bordered">
                    <thead class="table-head">
                        <th>Profesional</th>
                    </thead>
                    <tbody>
                      {% for permiso in permisos %}
                      <tr>
                          <td>{{permiso.get_nombre}}</td>
                      </tr>
                      {% endfor %}
                  </tbody>
                </table>

              </div>
          </div>
      </div>
  </div>

{% endif %}

{% endblock content %}
